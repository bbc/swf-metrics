#!/usr/bin/env node
const { join } = require('path');
const yargs = require('yargs');

yargs
  .usage('$0 <command> --domain <domain> [options]')
  .env('SWF_METRICS')
  .option('domain', {
    type: 'string',
    demand: true,
    describe: 'SWF domain to get metrics from',
  })
  .option('for', {
    type: 'string',
    describe: 'Duration of time of data to retrieve since the value of --since. Eg: 6hours, 1day, etc.',
    default: [1, 'hour'],
  })
  .option('since', {
    type: 'string',
    describe: 'Position in time from which we start retrieving the history of data.',
    default: new Date,
  })
  .coerce({
    since: input => new Date(input).toISOString(),
    for: input => {
      const [, digit, unit] = input.match(/(\d+)[\W\s]*([a-z]+)/i);
      return [digit, unit];
    }
  })
  .command('failed [--no-breakdown]', 'Display metrics about failed workflows.')
  .commandDir(join(__dirname, '..', 'lib', 'cli'))
  .global(['domain', 'for', 'since'])
  .help()
  .version()
  .strict()
  .argv;
